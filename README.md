# lib-food-categories

## Это репозиторий микросервиса для проекта "PANTREE"

#### Архитектура микросервисная. Подключена тестовая БД.

#### Каталог категорий продуктов с расширенной классификацией.

#### Поддержка пользовательских меток (например, "Любимые продукты", "Запрещенные аллергены").

#### Интеграция с открытыми базами (USDA, Open Food Facts).

Интеграции (Интегрировать пока не с чем - сервисы в разработке):

- Diet Service – предоставляет данные для проверки диетических правил.
- Recipe Service – список доступных ингредиентов.

Приложение написано на Java при помощи Spring и сопустствующих библиотек. Пример кода:

  ```java
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class LibFoodCategoriesApplication {

  public static void main(String[] args) {
    SpringApplication.run(LibFoodCategoriesApplication.class, args);
  }

}
  ```

# Описание микросервиса и базы данных "Категории продуктов питания"

## Возможности микросервиса

Микросервис предоставляет REST API для управления иерархической структурой категорий продуктов питания с следующими возможностями:

1. **CRUD операции**:
    - Создание новых категорий (`POST /api/food-categories`)
    - Получение категорий по ID (`GET /api/food-categories/{id}`)
    - Получение всех категорий с пагинацией и сортировкой (`GET /api/food-categories`)
    - Обновление существующих категорий (`PUT /api/food-categories/{id}`)
    - Удаление категорий (`DELETE /api/food-categories/{id}`)

2. **Иерархическое представление**:
    - Получение дерева категорий (`GET /api/food-categories/tree`)

3. **Кэширование**:
    - Индивидуальное кэширование категорий
    - Кэширование всего дерева категорий
    - Автоматическая очистка кэша при изменениях

4. **Валидация**:
    - Валидация входящих данных перед обработкой

5. **Пагинация и сортировка**:
    - Поддержка пагинации при получении списка категорий
    - Гибкая настройка сортировки по различным полям

## Описание базы данных

### Структура таблицы `food_categories`

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | BIGSERIAL | Первичный ключ, автоинкремент |
| `parent_id` | BIGINT | Внешний ключ на родительскую категорию (иерархия) |
| `name` | VARCHAR(100) | Название категории (обязательное) |
| `description` | TEXT | Описание категории |
| `is_final` | BOOLEAN | Флаг, указывающий, является ли категория конечной (не может иметь подкатегорий) |
| `created_at` | TIMESTAMP WITH TIME ZONE | Дата и время создания записи |
| `updated_at` | TIMESTAMP WITH TIME ZONE | Дата и время последнего обновления записи |

### Индексы

1. `idx_food_categories_parent` - индекс для ускорения поиска по родительской категории
2. `idx_food_categories_name` - индекс для ускорения поиска по названию категории

### Особенности

1. **Иерархическая структура**: Категории могут иметь подкатегории через поле `parent_id`
2. **Каскадное удаление**: При удалении родительской категории автоматически удаляются все дочерние
3. **Автоматическое обновление временных меток**: Поля `created_at` и `updated_at` обновляются автоматически
4. **Флаг конечной категории**: Поле `is_final` позволяет помечать категории, которые не могут содержать подкатегорий

### Примеры данных

В базе предустановлены основные корневые категории продуктов питания:
- Молочные продукты
- Мясо и птица
- Рыба и морепродукты
- Фрукты
- Овощи
- Бакалея
- и другие (всего 19 основных категорий)

Микросервис предназначен для интеграции в приложение PANTREE